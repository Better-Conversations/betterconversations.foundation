---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

// Get all blog posts from content collection
const allBlogPosts = await getCollection('blog');

// Content collection is working properly

// Convert to the format expected by the template and add sample posts
const blogPosts = [
  // Real blog post from content collection
  ...(allBlogPosts.length > 0 ? allBlogPosts.map((post, index) => ({
    id: index + 1,
    title: post.data.title,
    excerpt: post.data.excerpt,
    author: post.data.author,
    date: post.data.date.toLocaleDateString('en-GB', { year: 'numeric', month: 'long', day: 'numeric' }),
    category: post.data.category,
    slug: post.slug,
    readTime: `${post.data.readingTime || 5} min read`,
    featured: index === 0, // First post is featured
    image: post.data.image || "https://images.unsplash.com/photo-1552664730-d307ca884978?w=800&h=400&fit=crop"
  })) : []),
  {
    id: 2,
    title: "The Power of Better Conversations in Remote Teams",
    excerpt: "Learn practical strategies for fostering meaningful connections and productive dialogue in distributed work environments.",
    author: "Michael Chen",
    date: "January 12, 2024",
    category: "Remote Work",
    slug: null, // Sample post - no actual page
    readTime: "7 min read",
    featured: true,
    image: "https://images.unsplash.com/photo-1600880292203-757bb62b4baf?w=800&h=400&fit=crop"
  },
  {
    id: 3,
    title: "Emergent Knowledge: A Guide for Facilitators",
    excerpt: "Explore the principles of Emergent Knowledge and how to apply them in your facilitation practice.",
    author: "Emily Rodriguez",
    date: "January 10, 2024",
    category: "Facilitation",
    slug: null, // Sample post - no actual page
    readTime: "6 min read",
    featured: false,
    image: "https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?w=800&h=400&fit=crop"
  },
  {
    id: 4,
    title: "Building Trust Through Authentic Communication",
    excerpt: "Understanding the role of authenticity in creating lasting professional relationships and team dynamics.",
    author: "David Thompson",
    date: "January 8, 2024",
    category: "Leadership",
    slug: null, // Sample post - no actual page
    readTime: "4 min read",
    featured: false,
    image: "https://images.unsplash.com/photo-1521737711867-e3b97375f902?w=800&h=400&fit=crop"
  },
  {
    id: 5,
    title: "Success Stories: Transforming Organization Culture",
    excerpt: "Real-world examples of how Better Conversations training has revolutionized company cultures.",
    author: "Lisa Park",
    date: "January 5, 2024",
    category: "Success Stories",
    slug: null, // Sample post - no actual page
    readTime: "8 min read",
    featured: false,
    image: "https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=800&h=400&fit=crop"
  },
  {
    id: 6,
    title: "The Science Behind Effective Listening",
    excerpt: "Dive into the research that supports active listening techniques and their impact on communication outcomes.",
    author: "Dr. James Wilson",
    date: "January 3, 2024",
    category: "Research",
    slug: null, // Sample post - no actual page
    readTime: "10 min read",
    featured: false,
    image: "https://images.unsplash.com/photo-1434030216411-0b793f4b4173?w=800&h=400&fit=crop"
  },
  {
    id: 7,
    title: "Clean Language in Cross-Cultural Teams",
    excerpt: "Learn how Clean Language techniques can bridge cultural gaps and improve collaboration in multinational organizations.",
    author: "Dr. Maria Chen",
    date: "January 2, 2024", 
    category: "Clean Language",
    slug: null, // Sample post - no actual page
    readTime: "8 min read",
    featured: false,
    image: "https://images.unsplash.com/photo-1521737604893-d14cc237f11d?w=800&h=400&fit=crop"
  }
];

const categories = ["All", "Clean Language", "Remote Work", "Facilitation", "Leadership", "Success Stories", "Research"];
const featuredPosts = blogPosts.filter(post => post.featured);
const regularPosts = blogPosts.filter(post => !post.featured);
---

<Layout title="Blog - Better Conversations Foundation">
  <!-- Hero Section -->
  <section class="relative overflow-hidden bg-gradient-to-b from-white via-gray-50 to-white py-24 lg:py-32">
    <!-- Enhanced gradient background -->
    <div class="absolute inset-0 bg-gradient-to-br from-[#54C4B6]/25 via-transparent to-[#A8D381]/25"></div>
    
    <!-- Larger decorative circles -->
    <div class="absolute top-10 left-[5%] w-64 h-64 bg-[#54C4B6]/20 rounded-full blur-3xl"></div>
    <div class="absolute bottom-10 right-[5%] w-72 h-72 bg-[#A8D381]/20 rounded-full blur-3xl"></div>
    <div class="absolute top-40 right-[20%] w-48 h-48 bg-[#54C4B6]/15 rounded-full blur-2xl"></div>
    <div class="absolute bottom-20 left-[15%] w-56 h-56 bg-[#A8D381]/15 rounded-full blur-2xl"></div>
    
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 mb-6">
        Insights & <span class="text-[#54C4B6] relative">
          Stories
          <svg class="absolute -bottom-2 left-0 w-full" height="8" viewBox="0 0 200 8" preserveAspectRatio="none">
            <path d="M0 7 Q50 0 100 3 T200 7" stroke="#54C4B6" stroke-width="2" fill="none" opacity="0.5"/>
          </svg>
        </span>
      </h1>
      <p class="text-xl md:text-2xl text-gray-600 mb-8 max-w-3xl mx-auto">
        Explore articles, guides, and success stories from our community of communication professionals.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href="#latest" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-[#54C4B6] hover:bg-[#54C4B6]/90 transition-colors shadow-sm">
          Browse Articles
        </a>
        <a href="/contribute" class="inline-flex items-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors shadow-sm">
          Contribute a Story
        </a>
      </div>
    </div>
    
    <!-- Wave separator -->
    <div class="absolute bottom-0 left-0 right-0">
      <svg class="w-full h-16 text-white" preserveAspectRatio="none" viewBox="0 0 1440 54" fill="currentColor">
        <path d="M0,22L60,27.2C120,32,240,43,360,44.7C480,46,600,38,720,30.3C840,22,960,14,1080,16.3C1200,19,1320,32,1380,38.5L1440,45L1440,54L1380,54C1320,54,1200,54,1080,54C960,54,840,54,720,54C600,54,480,54,360,54C240,54,120,54,60,54L0,54Z"></path>
      </svg>
    </div>
  </section>

  <!-- Featured Posts -->
  <section class="py-16 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h2 class="text-base text-[#54C4B6] font-semibold tracking-wide uppercase">Featured</h2>
        <p class="mt-2 text-3xl leading-8 font-bold tracking-tight text-gray-900 sm:text-4xl mb-8">
          Spotlight Articles
        </p>
      </div>
      
      <div class="grid gap-8 lg:grid-cols-2">
        {featuredPosts.map((post) => (
          <article class="group relative bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-lg transition-shadow duration-300">
            <div class="aspect-w-16 aspect-h-9 bg-gray-200">
              <img src={post.image} alt={post.title} class="w-full h-48 object-cover object-top" />
            </div>
            <div class="p-6">
              <div class="flex items-center gap-4 text-sm text-gray-500 mb-3">
                <span class="text-[#54C4B6] font-medium">{post.category}</span>
                <span>{post.date}</span>
                <span>{post.readTime}</span>
              </div>
              <h3 class="text-xl font-bold text-gray-900 group-hover:text-[#54C4B6] transition-colors mb-3">
                <a href={post.slug ? `/blog/${post.slug}` : `#`} class="stretched-link">
                  {post.title}
                </a>
              </h3>
              <p class="text-gray-600 mb-4">{post.excerpt}</p>
              <div class="flex items-center">
                <div class="text-sm">
                  <p class="text-gray-900 font-medium">{post.author}</p>
                </div>
              </div>
            </div>
          </article>
        ))}
      </div>
    </div>
  </section>

  <!-- Main Blog Grid with Sidebar -->
  <section id="latest" class="py-16 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="lg:grid lg:grid-cols-4 lg:gap-8">
        <!-- Sidebar -->
        <aside class="mb-8 lg:mb-0">
          <div class="sticky top-20">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Categories</h3>
            <nav class="space-y-1">
              {categories.map((category) => (
                <a
                  href={`#${category.toLowerCase().replace(' ', '-')}`}
                  class="group flex items-center justify-between px-3 py-2 text-sm font-medium rounded-md hover:text-[#54C4B6] hover:bg-white transition-colors"
                >
                  {category}
                  <span class="text-xs text-gray-400 group-hover:text-[#54C4B6]">
                    {category === "All" ? blogPosts.length : blogPosts.filter(p => p.category === category).length}
                  </span>
                </a>
              ))}
            </nav>

            <div class="mt-8 p-6 bg-gradient-to-br from-[#54C4B6]/10 to-[#A8D381]/10 rounded-lg overflow-hidden">
              <h4 class="font-semibold text-gray-900 mb-2">Newsletter</h4>
              <p class="text-sm text-gray-600 mb-4">Get the latest insights delivered to your inbox.</p>
              <input type="email" placeholder="Your email" class="w-full px-3 py-2 mb-3 text-sm border border-gray-200 rounded-md focus:ring-[#54C4B6] focus:border-[#54C4B6]" />
              <button class="w-full px-4 py-2 bg-[#54C4B6] text-white rounded-md hover:bg-[#54C4B6]/90 transition-colors text-sm font-medium">
                Subscribe
              </button>
            </div>
          </div>
        </aside>

        <!-- Blog Posts Grid -->
        <div class="lg:col-span-3">
          <div class="flex items-center justify-between mb-8">
            <h2 class="text-2xl font-bold text-gray-900">Latest Articles</h2>
            <div class="flex items-center gap-2">
              <label for="sort" class="text-sm text-gray-600">Sort by:</label>
              <select id="sort" class="text-sm border-gray-300 rounded-md focus:ring-[#54C4B6] focus:border-[#54C4B6]">
                <option>Latest</option>
                <option>Popular</option>
                <option>Oldest</option>
              </select>
            </div>
          </div>

          <div class="grid gap-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3">
            {regularPosts.map((post) => (
              <article class="group bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow duration-300">
                <div class="aspect-w-16 aspect-h-9 bg-gray-200">
                  <img src={post.image} alt={post.title} class="w-full h-48 object-cover object-top" />
                </div>
                <div class="p-6">
                  <div class="flex items-center gap-3 text-xs text-gray-500 mb-2">
                    <span class="text-[#54C4B6] font-medium">{post.category}</span>
                    <span>{post.readTime}</span>
                  </div>
                  <h3 class="text-lg font-bold text-gray-900 group-hover:text-[#54C4B6] transition-colors mb-2">
                    <a href={post.slug ? `/blog/${post.slug}` : `#`}>
                      {post.title}
                    </a>
                  </h3>
                  <p class="text-sm text-gray-600 mb-3 line-clamp-2">{post.excerpt}</p>
                  <div class="flex items-center justify-between">
                    <p class="text-sm text-gray-500">{post.author}</p>
                    <p class="text-sm text-gray-400">{post.date}</p>
                  </div>
                </div>
              </article>
            ))}
          </div>

          <!-- Pagination -->
          <div class="mt-12 flex items-center justify-center gap-2">
            <button class="px-3 py-2 text-sm text-gray-500 hover:text-gray-700 transition-colors">
              Previous
            </button>
            <button class="px-3 py-2 text-sm font-medium text-white bg-[#54C4B6] rounded-md">1</button>
            <button class="px-3 py-2 text-sm text-gray-700 hover:text-[#54C4B6] transition-colors">2</button>
            <button class="px-3 py-2 text-sm text-gray-700 hover:text-[#54C4B6] transition-colors">3</button>
            <button class="px-3 py-2 text-sm text-gray-500 hover:text-gray-700 transition-colors">
              Next
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="py-16 bg-gradient-to-r from-[#54C4B6] to-[#A8D381]">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h2 class="text-3xl font-bold text-white mb-4">Share Your Story</h2>
      <p class="text-xl text-white/90 max-w-2xl mx-auto mb-8">
        Have insights about Better Conversations? We'd love to feature your experience in our community blog.
      </p>
      <a href="/contribute" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-[#54C4B6] bg-white hover:bg-gray-50 transition-colors">
        Submit an Article
      </a>
    </div>
  </section>
</Layout>